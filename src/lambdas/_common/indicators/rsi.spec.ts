import { ArrayCandle } from "../../lambda.types";
import { rsi } from "./rsi";

describe('rsi', () => {
	it('should work with the test data', () => {
		const actual = rsi(testCandles, 14);
		expect( actual ).toEqual( expectedResults );
	})
})

// test data generated by tools/csvToData.js script
const expectedResults = [
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	45.27494237734608,
	44.99436154574197,
	46.43054605358934,
	43.865672035329005,
	41.15630660082122,
	42.78313231957596,
	49.7740154677428,
	59.90209711266943,
	58.44335536156275,
	59.64204660439434,
	61.760018998583575,
	66.01393752758048,
	71.82552102085836,
	66.93454786183904,
	67.15952572732138,
	68.75768441106956,
	67.75356940391947,
	72.12908578864064,
	66.96454610935632,
	69.15412571711471,
	69.14116779917345,
	75.11040491886321,
	72.35282168181357,
	73.23569432238666,
	73.93725186292032,
	76.81439408220949,
	78.77997660142015,
	65.6437182007097,
	61.31047009506101,
	62.38916774037175,
	61.14080890806393,
	65.12873712762232,
	57.166647491013826,
	52.640476888503294,
	56.928364346665674,
	59.94602787387041,
	58.91115360745702,
	57.543085104763975,
	56.31034964394648,
	61.200740412956414,
	60.15047156923606,
	55.59325142216863,
	54.28052041565451,
	55.631241926882396,
	59.91708746474065,
	65.11816454844538, ]
const testCandles: ArrayCandle[] = [ [ 1631232000, 46389.7, 44842.2, 47035.8, 44135.2, 3303.07297039 ],
  [ 1631318400, 44842.2, 45137.4, 45992.4, 44741, 1239.97337633 ],
  [ 1631404800, 45148.8, 46061.3, 46487.9, 44770, 1202.06666163 ],
  [ 1631491200, 46061.3, 44965.8, 46879, 43374.9, 3673.51904919 ],
  [ 1631577600, 44965.8, 47145.9, 47260, 44700, 2114.13267011 ],
  [ 1631664000, 47110.5, 48152.3, 48481, 46744, 2151.18720019 ],
  [ 1631750400, 48152.3, 47786.9, 48485.8, 47030.1, 2289.67394172 ],
  [ 1631836800, 47786.9, 47269.7, 48185.9, 46745.7, 2007.83571876 ],
  [ 1631923200, 47269.7, 48309.9, 48800, 47077.9, 1277.08379196 ],
  [ 1632009600, 48306.9, 47237.8, 48379.1, 46851.2, 1219.51050215 ],
  [ 1632096000, 47247.3, 42992.9, 47307.7, 42510, 5755.78647313 ],
  [ 1632182400, 42992.9, 40710.6, 43624.7, 39579, 7259.61267188 ],
  [ 1632268800, 40710.5, 43562.8, 44024.2, 40600, 3430.28601932 ],
  [ 1632355200, 43563.3, 44889.8, 45000, 43111.6, 4171.04314642 ],
  [ 1632441600, 44888.9, 42833.2, 45153, 40750, 4407.09719872 ],
  [ 1632528000, 42831.7, 42710.1, 43021.7, 41705.1, 1058.57183586 ],
  [ 1632614400, 42710.1, 43204.6, 43930.4, 40802.7, 2250.76323745 ],
  [ 1632700800, 43175.2, 42176.3, 44333, 42120.7, 1977.89964159 ],
  [ 1632787200, 42176.3, 41038.4, 42750, 40875.6, 2231.71257206 ],
  [ 1632873600, 41016, 41524.8, 42579.9, 40772.2, 1707.74975383 ],
  [ 1632960000, 41523.9, 43798.7, 44100, 41423.7, 3053.23090867 ],
  [ 1633046400, 43798.7, 48163.7, 48475, 43300.3, 6512.03024789 ],
  [ 1633132800, 48168.8, 47662, 48349.2, 47487.1, 1621.17649347 ],
  [ 1633219200, 47657.3, 48230.2, 49257.9, 47131.1, 1653.13750113 ],
  [ 1633305600, 48228.6, 49243.3, 49500, 46895.8, 2828.92263936 ],
  [ 1633392000, 49239.2, 51487, 51888, 49084.3, 4047.31458904 ],
  [ 1633478400, 51492.9, 55350.2, 55770, 50366.4, 7379.34314845 ],
  [ 1633564800, 55350.2, 53817.3, 55352.2, 53399.8, 3074.65033031 ],
  [ 1633651200, 53817.4, 53960.5, 56114.1, 53685, 2595.57677126 ],
  [ 1633737600, 53960.9, 54960.2, 55515.1, 53712, 1216.55973499 ],
  [ 1633824000, 54967.4, 54677.5, 56500, 54118.6, 2295.10818143 ],
  [ 1633910400, 54678.9, 57499.5, 57837.7, 54450.2, 2787.09612904 ],
  [ 1633996800, 57482.8, 56010.1, 57673.8, 54019.2, 3699.83673303 ],
  [ 1634083200, 55991.9, 57381.2, 57777, 54271.2, 3018.73591985 ],
  [ 1634169600, 57381.2, 57377.6, 58580.4, 56825, 2594.22360564 ],
  [ 1634256000, 57357.1, 61656.2, 62887.5, 56888.5, 5168.88639071 ],
  [ 1634342400, 61669.8, 60873.4, 62400, 60162, 1963.72806446 ],
  [ 1634428800, 60868.5, 61526.5, 61674.3, 58900.2, 2142.26443974 ],
  [ 1634515200, 61526.1, 62037.7, 62672.6, 59900, 3406.19056422 ],
  [ 1634601600, 62009.6, 64284.9, 64448, 61320, 3564.49206667 ],
  [ 1634688000, 64291.6, 66035.8, 66982.2, 63546.2, 3552.48626789 ],
  [ 1634774400, 66035.7, 62198, 66637.8, 54100, 6502.27028944 ],
  [ 1634860800, 62197.4, 60687.5, 63757.9, 60034.2, 2968.91457098 ],
  [ 1634947200, 60687.5, 61296.9, 61713.9, 59610.4, 1276.37709253 ],
  [ 1635033600, 61297.6, 60882.5, 61450, 59523, 1443.19001317 ],
  [ 1635120000, 60865.1, 63081.8, 63700, 60674, 2256.81962998 ],
  [ 1635206400, 63081.7, 60310.2, 63288, 59824.2, 2574.26550076 ],
  [ 1635292800, 60325.1, 58500.1, 61477.1, 58140.6, 3954.31707153 ],
  [ 1635379200, 58500.1, 60613.5, 62490, 57948, 4393.97638147 ],
  [ 1635465600, 60604.5, 62246.5, 62950, 60223.5, 2728.80922519 ],
  [ 1635552000, 62246.4, 61866.3, 62359.2, 60741.1, 1202.80701854 ],
  [ 1635638400, 61879.2, 61380.1, 62422.8, 60051, 1518.03039144 ],
  [ 1635724800, 61380.1, 60954.5, 62500, 59449.1, 2649.55088957 ],
  [ 1635811200, 60954.5, 63279.7, 64327, 60665.9, 2733.11225391 ],
  [ 1635897600, 63279.8, 62942.9, 63550.4, 60810.3, 2567.94815305 ],
  [ 1635984000, 62938, 61449, 63115, 60644.2, 1869.2061661 ],
  [ 1636070400, 61448.9, 61006.2, 62631.9, 60804.4, 1419.74213073 ],
  [ 1636156800, 61007.4, 61536.3, 61602.1, 60129.8, 1337.98498424 ],
  [ 1636243200, 61535.4, 63317.8, 63317.8, 61388, 1554.00196888 ],
  [ 1636329600, 63319.6, 65871.3, 66523.7, 63319.6, 3050.84398135 ] ]