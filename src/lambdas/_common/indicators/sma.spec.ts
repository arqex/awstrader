import { ArrayCandle } from "../../lambda.types";
import { sma, smaArray } from "./sma";


describe('sma', () => {
	it('calculate sma from array of values', () => {
		const values = [1,2,3,4,5,6,7,8,9,10,11,12,13];
		expect( smaArray(values, 8) ).toEqual([0,0,0,0,0,0,0,4.5, 5.5, 6.5, 7.5, 8.5, 9.5]);
	});

	it('calculate sma from array of candles', () => {
		const candles = [[0,0,1],[0,0,2],[0,0,3],[0,0,4],[0,0,5],[0,0,6],[0,0,7],[0,0,8],[0,0,9],[0,0,10],[0,0,11],[0,0,12],[0,0,13]];
		// @ts-ignore
		expect( sma(candles, 8) ).toEqual([0,0,0,0,0,0,0,4.5, 5.5, 6.5, 7.5, 8.5, 9.5]);
	})

	it('should return expected results', () => {
		const actual = sma( testCandles, 9 );
		console.log( actual );
		expect( actual ).toEqual( expectedResults );
	});
})


const expectedResults = [ 0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		51430.48888888889,
		52154.24444444445,
		53247.3,
		54111.73333333334,
		55015.944444444445,
		55670.455555555556,
		56371.12222222222,
		57155.13333333333,
		57995.799999999996,
		58782.188888888886,
		59849.677777777775,
		60798.15555555556,
		61485.700000000004,
		61853.06666666668,
		62288.54444444446,
		62202.5777777778,
		62447.95555555558,
		62312.81111111113,
		61919.74444444446,
		61511.81111111113,
		61090.77777777779,
		61053.92222222224,
		61130.877777777794,
		61092.83333333334,
		61359.18888888889,
		61343.75555555556,
		61470.2888888889,
		61748.744444444455,
		61851.27777777779,
		61970.31111111113,
		62602.92222222224,
		63215.500000000015 ]
const testCandles: ArrayCandle[] = [ [ 1633046400, 43798.7, 48163.7, 48475, 43300.3, 6512.03024789 ],
  [ 1633132800, 48168.8, 47662, 48349.2, 47487.1, 1621.17649347 ],
  [ 1633219200, 47657.3, 48230.2, 49257.9, 47131.1, 1653.13750113 ],
  [ 1633305600, 48228.6, 49243.3, 49500, 46895.8, 2828.92263936 ],
  [ 1633392000, 49239.2, 51487, 51888, 49084.3, 4047.31458904 ],
  [ 1633478400, 51492.9, 55350.2, 55770, 50366.4, 7379.34314845 ],
  [ 1633564800, 55350.2, 53817.3, 55352.2, 53399.8, 3074.65033031 ],
  [ 1633651200, 53817.4, 53960.5, 56114.1, 53685, 2595.44015122 ],
  [ 1633737600, 53960.9, 54960.2, 55515.1, 53700, 1220.39617158 ],
  [ 1633824000, 54967.4, 54677.5, 56500, 54118.6, 2295.10818143 ],
  [ 1633910400, 54678.9, 57499.5, 57837.7, 54450.2, 2787.09612904 ],
  [ 1633996800, 57482.8, 56010.1, 57673.8, 54019.2, 3699.83673303 ],
  [ 1634083200, 55991.9, 57381.2, 57777, 54271.2, 3017.4304618 ],
  [ 1634169600, 57381.2, 57377.6, 58580.4, 56825, 2594.17461395 ],
  [ 1634256000, 57357.1, 61656.2, 62887.5, 56888.5, 5168.07233194 ],
  [ 1634342400, 61669.8, 60873.4, 62400, 60162, 1963.72806446 ],
  [ 1634428800, 60868.5, 61526.5, 61674.3, 58900.2, 2142.26443974 ],
  [ 1634515200, 61526.1, 62037.7, 62672.6, 59900, 3406.19056422 ],
  [ 1634601600, 62009.6, 64284.9, 64448, 61320, 3564.49206667 ],
  [ 1634688000, 64291.6, 66035.8, 66982.2, 63546.2, 3549.62292947 ],
  [ 1634774400, 66035.7, 62198, 66637.8, 54100, 6480.46357995 ],
  [ 1634860800, 62197.4, 60687.5, 63757.9, 60034.2, 2968.70503913 ],
  [ 1634947200, 60687.5, 61296.9, 61713.9, 59610.4, 1276.37709253 ],
  [ 1635033600, 61297.6, 60882.5, 61450, 59523, 1443.19001317 ],
  [ 1635120000, 60865.1, 63081.8, 63700, 60674, 2256.60065874 ],
  [ 1635206400, 63081.7, 60310.2, 63288, 59824.2, 2574.26550076 ],
  [ 1635292800, 60325.1, 58500.1, 61477.1, 58140.6, 3954.31807153 ],
  [ 1635379200, 58500.1, 60613.5, 62490, 57948, 4393.97638147 ],
  [ 1635465600, 60604.5, 62246.5, 62950, 60223.5, 2725.25641851 ],
  [ 1635552000, 62246.4, 61866.3, 62359.2, 60741.1, 1202.80701854 ],
  [ 1635638400, 61879.2, 61380.1, 62422.8, 60051, 1518.03039144 ],
  [ 1635724800, 61380.1, 60954.5, 62500, 59449.1, 2649.55088957 ],
  [ 1635811200, 60954.5, 63279.7, 64327, 60665.9, 2728.46636 ],
  [ 1635897600, 63279.8, 62942.9, 63550.4, 60810.3, 2573.43392899 ],
  [ 1635984000, 62938, 61449, 63115, 60644.2, 1869.32799097 ],
  [ 1636070400, 61448.9, 61006.2, 62631.9, 60804.4, 1430.9820694 ],
  [ 1636156800, 61007.4, 61536.3, 61602.1, 60129.8, 1337.98498424 ],
  [ 1636243200, 61535.4, 63317.8, 63317.8, 61388, 1554.00196888 ],
  [ 1636329600, 63319.6, 67559.8, 67777.7, 63319.6, 3859.96266718 ],
  [ 1636416000, 67550.8, 66893.3, 68495, 66511, 2315.14597599 ] ]